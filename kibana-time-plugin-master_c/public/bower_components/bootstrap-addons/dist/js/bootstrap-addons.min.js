angular.module("BootstrapAddons",["BootstrapAddonsTemplateCache"]),angular.module("BootstrapAddons").directive("timeslider",["$document","$timeout",function(t,e){const n="timesliderSvg",a=112,i=72,r=864e5;return{restrict:"E",scope:{end:"=",onClear:"&",onChange:"&",playback:"=?",start:"=",width:"@"},templateUrl:"timeslider/timeslider.html",replace:!0,link:function(t,c,s){function l(){b.extent()[0].getTime()===b.extent()[1].getTime()?e(function(){t.onClear()()}):d3.event.sourceEvent?d3.select(this).transition().call(b.extent(d(b.extent()))).call(b.event):e(function(){t.onChange()(b.extent()[0],b.extent()[1])})}function d(e){var n=e[0],a=e[1],i=T.round(n),r=T.round(a);return i.getTime()===r.getTime()&&(i=T.floor(n),r=T.ceil(a)),i.getTime()<=t.start.getTime()&&(i=t.start),r.getTime()>=t.end.getTime()&&(r=t.end),t.start.getTime()===n.getTime()&&(i=t.start),t.end.getTime()===a.getTime()&&(r=t.end),[i,r]}function o(t,e){b.extent(d([t,e])),b(d3.select(".ba-brush")),b.event(d3.select(".ba-brush"))}function m(){var e=b.extent()[1].getTime()-b.extent()[0].getTime();return 0>=e&&(e=(t.end.getTime()-t.start.getTime())/45),e}function u(){if(c[0].clientWidth>0){var t=null;b&&(t=b.extent()),g(),t&&t[0].getTime()!==t[1].getTime()&&(b.extent([t[0],t[1]]),b(d3.select(".ba-brush")))}}function g(){if(f&&(t.width=c[0].clientWidth-i),!(t.width<=0)){var e=t.width/a,r=t.end.getTime()-t.start.getTime(),s=d3.select("#ba-timeslider-container");s.selectAll("#"+n).remove();var d=s.append("svg").attr("id",n).attr("width",t.width).attr("height",22);d.append("g").append("rect").attr("x",0).attr("y",0).attr("width",t.width).attr("height",22).attr("class","ba-timeslider");var o=d3.time.scale.utc().domain([t.start.getTime(),t.end.getTime()]).range([0,parseInt(t.width,10)]),m=o(t.end.getTime()),u=null;o.ticks(e).forEach(function(t,e){var n=o(t);if(d.append("line").attr("class","ba-scaleline").attr("x1",n).attr("x2",n).attr("y1",0).attr("y2",22),n>25&&m-n>25){var a=p(r,t,u),i=a(t).split(" ");1===i.length&&i.push(""),u=t,d.append("text").attr("class","ba-scalelabel").attr("x",n).attr("dx",function(){var t="-1.25em";if(i[0].length>2)var t="-2.25em";return t}).attr("y",11).attr("text-anchor","left").attr("dominant-baseline","middle").text(i[0]),d.append("text").attr("class","ba-scalelabel").attr("x",n).attr("dx","0.25em").attr("y",11).attr("text-anchor","right").attr("dominant-baseline","middle").text(i[1])}}),b=d3.svg.brush().x(o).on("brushend",l),d.append("g").attr("class","ba-brush").call(b).selectAll("rect").attr("height",22)}}function p(t,e,n){var a=null;return a=r>=t?n?d3.time.format.utc("%H %M"):d3.time.format.utc("%a %d"):24192e5>=t?n&&e.getUTCDate()===n.getUTCDate()?d3.time.format.utc("%H %M"):d3.time.format.utc("%a %d"):31536e6>=t?d3.time.format.utc("%b %d"):n&&e.getUTCFullYear()===n.getUTCFullYear()?d3.time.format.utc("%b %d"):d3.time.format.utc("%b %Y")}function h(t){var e;switch(t){case"s":e=d3.time.second.utc;break;case"m":e=d3.time.minute.utc;break;case"h":e=d3.time.hour.utc;break;case"d":e=d3.time.day.utc;break;case"w":e=d3.time.week.utc;break;case"M":e=d3.time.month.utc;break;case"y":e=d3.time.year.utc;break;default:console.log("Unexpected snap interval: "+t+", defaulting to seconds."),e=d3.time.second.utc}return e}var b,T=h("s"),f=!1;t.width||(f=!0),t.actionIcon="glyphicon-play";g(),t.$on("timesliderForceRender",function(){u()}),t.$on("timesliderSnapToNearest",function(t,e){T=h(e.snapToNearest),b.extent()[0].getTime()!==b.extent()[1].getTime()&&o(b.extent()[0],b.extent()[1])});var v=t.playback;v||(v={intervalId:null,play:function(t){this.intervalId=setInterval(function(){t()},1e3)},pause:function(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)}}),t.togglePlay=function(){"glyphicon-play"===t.actionIcon?(t.actionIcon="glyphicon-pause",v.play(t.stepForward)):(t.actionIcon="glyphicon-play",v.pause())},t.stepBack=function(){var e=new Date(b.extent()[0].getTime()-m()),n=b.extent()[0];n.getTime()<=t.start.getTime()&&(e=new Date(t.end.getTime()-m()),n=t.end),o(e,n)},t.stepForward=function(){var e=b.extent()[1],n=new Date(b.extent()[1].getTime()+m());e.getTime()>=t.end.getTime()&&(e=t.start,n=new Date(t.start.getTime()+m())),o(e,n)}}}}]),angular.module("BootstrapAddonsTemplateCache",[]).run(["$templateCache",function(t){t.put("timeslider/timeslider.html",'<div><div class="btn-group"><button class="btn btn-xs btn-primary" ng-click="togglePlay()"><span class="glyphicon {{actionIcon}}"></span></button> <button class="btn btn-xs btn-primary" ng-click="stepBack()"><span class="glyphicon glyphicon-step-backward"></span></button> <button class="btn btn-xs btn-primary" ng-click="stepForward()"><span class="glyphicon glyphicon-step-forward"></span></button> <span id="ba-timeslider-container"></span></div></div>')}]);